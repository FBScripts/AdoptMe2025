-- ==========================================
-- –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –î–ï–ë–ê–ì –ö–û–î –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê BACKPACK –ò –¢–†–ï–ô–î–ê
-- ==========================================

local function debugBackpackAndTradeSystem()
    print("=== –ù–ê–ß–ê–õ–û –ê–ù–ê–õ–ò–ó–ê BACKPACK –ò –¢–†–ï–ô–î –°–ò–°–¢–ï–ú–´ ===")
    
    -- –ó–∞–≥—Ä—É–∂–∞–µ–º Fsys –µ—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
    if not _G.Fsys then
        _G.Fsys = require(game:GetService("ReplicatedStorage").Fsys)
    end
    
    local Fsys = _G.Fsys
    
    -- 1. –ê–Ω–∞–ª–∏–∑ TradeApp - –∫–ª—é—á–µ–≤–æ–π –º–æ–¥—É–ª—å –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏
    print("\n--- 1. –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó TRADEAPP ---")
    pcall(function()
        local TradeApp = Fsys.load("TradeApp")
        if TradeApp then
            print("‚úÖ TradeApp –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ!")
            
            -- –ò—â–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è UI
            for key, value in pairs(TradeApp) do
                local key_str = tostring(key):lower()
                if type(value) == "function" then
                    if string.find(key_str, "set") or 
                       string.find(key_str, "show") or 
                       string.find(key_str, "hide") or
                       string.find(key_str, "visible") or
                       string.find(key_str, "enable") or
                       string.find(key_str, "disable") then
                        print("  üéØ –§—É–Ω–∫—Ü–∏—è UI:", key)
                    end
                elseif type(value) == "table" then
                    -- –í–æ–∑–º–æ–∂–Ω–æ —ç—Ç–æ —Å–æ–±—ã—Ç–∏—è –∏–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                    if string.find(key_str, "event") or 
                       string.find(key_str, "state") or
                       string.find(key_str, "start") or
                       string.find(key_str, "end") then
                        print("  üì¢ –°–æ–±—ã—Ç–∏–µ/–°–æ—Å—Ç–æ—è–Ω–∏–µ:", key)
                    end
                end
            end
            
            -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Ç–∞—Ç–∞–±–ª–∏—Ü—É –Ω–∞ —Å–æ–±—ã—Ç–∏—è
            local meta = getmetatable(TradeApp)
            if meta then
                for meta_key, meta_value in pairs(meta) do
                    print("  üîç –ú–µ—Ç–∞-–∫–ª—é—á:", meta_key, type(meta_value))
                end
            end
        end
    end)
    
    -- 2. –ê–Ω–∞–ª–∏–∑ Backpack –º–æ–¥—É–ª–µ–π
    print("\n--- 2. –ê–ù–ê–õ–ò–ó BACKPACK –ú–û–î–£–õ–ï–ô ---")
    local backpack_modules = {
        "Backpack",
        "BackpackFilter", 
        "BackpackCategoryButtons",
        "BackpackItemStackHashHelper"
    }
    
    for _, module_name in ipairs(backpack_modules) do
        pcall(function()
            local module = Fsys.load(module_name)
            if module then
                print("‚úÖ " .. module_name .. " –∑–∞–≥—Ä—É–∂–µ–Ω")
                
                -- –ò—â–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
                for key, value in pairs(module) do
                    if type(value) == "function" then
                        local key_str = tostring(key):lower()
                        if string.find(key_str, "visible") or 
                           string.find(key_str, "show") or 
                           string.find(key_str, "hide") then
                            print("  üëÅÔ∏è  –§—É–Ω–∫—Ü–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏:", key)
                        end
                    end
                end
            end
        end)
    end
    
    -- 3. –ê–Ω–∞–ª–∏–∑ RouterClient –¥–ª—è —Å–æ–±—ã—Ç–∏–π —Ç–æ—Ä–≥–æ–≤–ª–∏
    print("\n--- 3. –ê–ù–ê–õ–ò–ó ROUTERCLIENT –î–õ–Ø –°–û–ë–´–¢–ò–ô –¢–†–ï–ô–î–ê ---")
    pcall(function()
        local RouterClient = Fsys.load("RouterClient")
        if RouterClient then
            print("‚úÖ RouterClient –∑–∞–≥—Ä—É–∂–µ–Ω")
            
            -- –ò—â–µ–º —Å–æ–±—ã—Ç–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ç–æ—Ä–≥–æ–≤–ª–µ–π
            for key, value in pairs(RouterClient) do
                local key_str = tostring(key):lower()
                if string.find(key_str, "trade") then
                    print("  üîÑ –¢—Ä–µ–π–¥-—Å–æ–±—ã—Ç–∏–µ:", key, "—Ç–∏–ø:", type(value))
                    
                    -- –ï—Å–ª–∏ —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                    if type(value) == "function" then
                        local success, info = pcall(debug.getinfo, value)
                        if success then
                            print("    üìç –ò—Å—Ç–æ—á–Ω–∏–∫:", info.source or "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")
                        end
                    end
                end
            end
        end
    end)
    
    -- 4. –ü–æ–∏—Å–∫ FocusPetApp (–≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ä—é–∫–∑–∞–∫)
    print("\n--- 4. –ü–û–ò–°–ö FOCUSPETAPP ---")
    pcall(function()
        local FocusPetApp = Fsys.load("FocusPetApp")
        if FocusPetApp then
            print("‚úÖ FocusPetApp –∑–∞–≥—Ä—É–∂–µ–Ω!")
            
            -- –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            for key, value in pairs(FocusPetApp) do
                local key_str = tostring(key):lower()
                print("  üîë –ö–ª—é—á:", key, "—Ç–∏–ø:", type(value))
                
                -- –ï—Å–ª–∏ —ç—Ç–æ —Ç–∞–±–ª–∏—Ü–∞, –∏—â–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                if type(value) == "table" then
                    for sub_key, sub_value in pairs(value) do
                        local sub_str = tostring(sub_key):lower()
                        if string.find(sub_str, "backpack") or 
                           string.find(sub_str, "inventory") then
                            print("    üéí Backpack —ç–ª–µ–º–µ–Ω—Ç:", sub_key, "—Ç–∏–ø:", type(sub_value))
                        end
                    end
                end
            end
        else
            print("‚ùå FocusPetApp –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∏–º–µ–Ω–∞...")
            
            -- –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ—Ö–æ–∂–∏–µ –º–æ–¥—É–ª–∏
            for module_name, module_script in pairs(getfenv(Fsys.load).tbl_5_upvr or {}) do
                if string.find(tostring(module_name):lower(), "pet") and 
                   string.find(tostring(module_name):lower(), "app") then
                    print("  üîç –ù–∞–π–¥–µ–Ω –ø–æ—Ö–æ–∂–∏–π –º–æ–¥—É–ª—å:", module_name)
                end
            end
        end
    end)
    
    -- 5. –ü–æ–∏—Å–∫ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è UI –ø—Ä–∏ —Ç—Ä–µ–π–¥–µ
    print("\n--- 5. –ü–û–ò–°–ö –§–£–ù–ö–¶–ò–ò –û–¢–ö–õ–Æ–ß–ï–ù–ò–Ø UI –ü–†–ò –¢–†–ï–ô–î–ï ---")
    
    local function searchForDisableFunction(module, module_name)
        for key, value in pairs(module) do
            if type(value) == "function" then
                local key_str = tostring(key):lower()
                -- –ò—â–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –æ—Ç–∫–ª—é—á–∞—Ç—å UI
                if (string.find(key_str, "disable") or 
                    string.find(key_str, "hide") or
                    string.find(key_str, "close")) and
                   (string.find(key_str, "ui") or
                    string.find(key_str, "app") or
                    string.find(key_str, "screen")) then
                    print("  üö´ –í–æ–∑–º–æ–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è UI:", module_name .. "." .. key)
                    
                    -- –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ—É–Ω–∫—Ü–∏–∏
                    local success, info = pcall(debug.getinfo, value)
                    if success and info then
                        if info.source then
                            print("    üìç –ò—Å—Ç–æ—á–Ω–∏–∫:", info.source)
                        end
                    end
                end
            end
        end
    end
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ –º–æ–¥—É–ª–∏
    local key_modules_to_check = {"TradeApp", "RouterClient", "FocusPetApp", "Backpack"}
    for _, module_name in ipairs(key_modules_to_check) do
        pcall(function()
            local module = Fsys.load(module_name)
            if module then
                searchForDisableFunction(module, module_name)
            end
        end)
    end
    
    -- 6. –ê–Ω–∞–ª–∏–∑ —Å–≤—è–∑–∏ –º–µ–∂–¥—É TradeApp –∏ Backpack
    print("\n--- 6. –ê–ù–ê–õ–ò–ó –°–í–Ø–ó–ò TRADEAPP –ò BACKPACK ---")
    pcall(function()
        local TradeApp = Fsys.load("TradeApp")
        if TradeApp then
            -- –ò—â–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ backpack –∏–ª–∏ inventory –≤ TradeApp
            for key, value in pairs(TradeApp) do
                if type(value) == "function" then
                    -- –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è backpack –≤ –∫–æ–¥–µ —Ñ—É–Ω–∫—Ü–∏–∏
                    local func_str = tostring(value)
                    if string.find(func_str:lower(), "backpack") or 
                       string.find(func_str:lower(), "inventory") then
                        print("  üîó TradeApp —Ñ—É–Ω–∫—Ü–∏—è —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ backpack:", key)
                    end
                end
            end
        end
    end)
    
    -- 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ –∏–≥—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–∞—Ö
    print("\n--- 7. –ü–†–û–í–ï–†–ö–ê –ò–ì–†–û–í–´–• –û–ë–™–ï–ö–¢–û–í ---")
    pcall(function()
        local players = game:GetService("Players")
        local localPlayer = players.LocalPlayer
        if localPlayer then
            local playerGui = localPlayer:FindFirstChild("PlayerGui")
            if playerGui then
                -- –ò—â–µ–º FocusPetApp –≤ PlayerGui
                local focusPetApp = playerGui:FindFirstChild("FocusPetApp")
                if focusPetApp then
                    print("‚úÖ FocusPetApp –Ω–∞–π–¥–µ–Ω –≤ PlayerGui!")
                    
                    -- –ò—â–µ–º Backpack –≤–Ω—É—Ç—Ä–∏ FocusPetApp
                    local function findBackpack(parent, path)
                        for _, child in ipairs(parent:GetChildren()) do
                            local fullPath = path .. "." .. child.Name
                            if string.find(child.Name:lower(), "backpack") then
                                print("üéí –ù–∞–π–¥–µ–Ω Backpack:", fullPath)
                                
                                -- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞
                                if child:IsA("GuiObject") then
                                    print("   üëÅÔ∏è  Visible:", child.Visible)
                                    print("   üéØ Active:", child.Active)
                                end
                            end
                            findBackpack(child, fullPath)
                        end
                    end
                    
                    findBackpack(focusPetApp, "PlayerGui.FocusPetApp")
                else
                    print("‚ùå FocusPetApp –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ PlayerGui")
                    -- –í—ã–≤–æ–¥–∏–º —á—Ç–æ –µ—Å—Ç—å –≤ PlayerGui
                    for _, child in ipairs(playerGui:GetChildren()) do
                        print("  üìÅ –í PlayerGui:", child.Name)
                    end
                end
            end
        end
    end)
    
    print("\n=== –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù ===")
    print("üìã –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏:")
    print("‚Ä¢ TradeApp - –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å —Ç–æ—Ä–≥–æ–≤–ª–∏")
    print("‚Ä¢ Backpack –º–æ–¥—É–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã") 
    print("‚Ä¢ RouterClient —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è–º–∏")
    print("‚Ä¢ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –Ω–∞–π—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Ä—é–∫–∑–∞–∫–∞")
end

-- –ó–∞–ø—É—Å–∫–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑
debugBackpackAndTradeSystem()

return {
    debugBackpackAndTradeSystem = debugBackpackAndTradeSystem
}
