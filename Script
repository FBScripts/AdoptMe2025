-- ==========================================
-- –°–ö–†–ò–ü–¢ –î–õ–Ø –°–û–•–†–ê–ù–ï–ù–ò–Ø –ê–ö–¢–ò–í–ù–û–°–¢–ò BACKPACK –ü–†–ò –¢–†–ï–ô–î–ï
-- ==========================================

local function keepBackpackActiveDuringTrade()
    print("=== –ê–ö–¢–ò–í–ê–¶–ò–Ø –°–ö–†–ò–ü–¢–ê –°–û–•–†–ê–ù–ï–ù–ò–Ø BACKPACK ===")
    
    -- –ó–∞–≥—Ä—É–∂–∞–µ–º Fsys
    if not _G.Fsys then
        _G.Fsys = require(game:GetService("ReplicatedStorage").Fsys)
    end
    
    local Fsys = _G.Fsys
    
    -- 1. –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é hide_ui –≤ FocusPetApp
    pcall(function()
        local FocusPetApp = Fsys.load("FocusPetApp")
        if FocusPetApp and FocusPetApp.hide_ui then
            local original_hide_ui = FocusPetApp.hide_ui
            
            FocusPetApp.hide_ui = function(...)
                print("üö´ FocusPetApp.hide_ui –≤—ã–∑–≤–∞–Ω–∞, –Ω–æ –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä—ã—Ç–∏–µ!")
                print("   Backpack –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º –≤–æ –≤—Ä–µ–º—è —Ç—Ä–µ–π–¥–∞")
                
                -- –í–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                -- –∏–ª–∏ –≤–æ–æ–±—â–µ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å —á—Ç–æ–±—ã —Ä—é–∫–∑–∞–∫ –æ—Å—Ç–∞–≤–∞–ª—Å—è –≤–∏–¥–∏–º—ã–º
                
                return true -- –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—Ö, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–∫—Ä—ã–≤–∞–µ–º
            end
            
            print("‚úÖ –§—É–Ω–∫—Ü–∏—è hide_ui –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–∞! Backpack –Ω–µ –±—É–¥–µ—Ç —Å–∫—Ä—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ —Ç—Ä–µ–π–¥–µ")
        end
    end)
    
    -- 2. –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º set_visible –≤ BackpackFilter
    pcall(function()
        local BackpackFilter = Fsys.load("BackpackFilter")
        if BackpackFilter and BackpackFilter.set_visible then
            local original_set_visible = BackpackFilter.set_visible
            
            BackpackFilter.set_visible = function(self, visible, ...)
                print("üîß BackpackFilter.set_visible –≤—ã–∑–≤–∞–Ω–∞:", visible)
                
                -- –ï—Å–ª–∏ –ø—ã—Ç–∞—é—Ç—Å—è —Å–∫—Ä—ã—Ç—å —Ä—é–∫–∑–∞–∫ (visible = false), –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
                if visible == false then
                    print("   ‚ö†Ô∏è  –ü–æ–ø—ã—Ç–∫–∞ —Å–∫—Ä—ã—Ç—å —Ä—é–∫–∑–∞–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞!")
                    return -- –ù–µ –≤—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
                end
                
                -- –ï—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä—é–∫–∑–∞–∫ (visible = true), —Ä–∞–∑—Ä–µ—à–∞–µ–º
                return original_set_visible(self, visible, ...)
            end
            
            print("‚úÖ –§—É–Ω–∫—Ü–∏—è BackpackFilter.set_visible –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–∞!")
        end
    end)
    
    -- 3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º hide –≤ FocusPetApp
    pcall(function()
        local FocusPetApp = Fsys.load("FocusPetApp")
        if FocusPetApp and FocusPetApp.hide then
            local original_hide = FocusPetApp.hide
            
            FocusPetApp.hide = function(...)
                print("üö´ FocusPetApp.hide –≤—ã–∑–≤–∞–Ω–∞, –Ω–æ —Ä—é–∫–∑–∞–∫ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤–∏–¥–∏–º—ã–º!")
                -- –ù–µ –≤—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —á—Ç–æ–±—ã –Ω–µ —Å–∫—Ä—ã–≤–∞—Ç—å
                return true
            end
            
            print("‚úÖ –§—É–Ω–∫—Ü–∏—è FocusPetApp.hide –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–∞!")
        end
    end)
    
    -- 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–º —Å–æ–±—ã—Ç–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏
    pcall(function()
        local TradeApp = Fsys.load("TradeApp")
        if TradeApp then
            -- –ò—â–µ–º —Å–æ–±—ã—Ç–∏—è –Ω–∞—á–∞–ª–∞/–æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏
            for key, value in pairs(TradeApp) do
                if type(value) == "table" and tostring(key):find("event") then
                    print("üîç –ù–∞–π–¥–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ TradeApp:", key)
                end
            end
        end
    end)
    
    -- 5. –°–æ–∑–¥–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    local function createControlPanel()
        if not game:GetService("CoreGui"):FindFirstChild("BackpackControl") then
            local ScreenGui = Instance.new("ScreenGui")
            ScreenGui.Name = "BackpackControl"
            ScreenGui.Parent = game:GetService("CoreGui")
            
            local Frame = Instance.new("Frame")
            Frame.Size = UDim2.new(0, 200, 0, 100)
            Frame.Position = UDim2.new(0, 10, 0, 10)
            Frame.BackgroundColor3 = Color3.new(0, 0, 0)
            Frame.BackgroundTransparency = 0.3
            Frame.Parent = ScreenGui
            
            local Label = Instance.new("TextLabel")
            Label.Size = UDim2.new(1, 0, 0, 30)
            Label.Text = "Backpack Control: ACTIVE"
            Label.TextColor3 = Color3.new(0, 1, 0)
            Label.BackgroundTransparency = 1
            Label.Parent = Frame
            
            local Status = Instance.new("TextLabel")
            Label.Size = UDim2.new(1, 0, 0, 30)
            Label.Position = UDim2.new(0, 0, 0, 35)
            Label.Text = "–†—é–∫–∑–∞–∫ –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º"
            Label.TextColor3 = Color3.new(1, 1, 1)
            Label.BackgroundTransparency = 1
            Label.Parent = Frame
        end
    end
    
    pcall(createControlPanel)
    
    print("\n=== –°–ö–†–ò–ü–¢ –ê–ö–¢–ò–í–ò–†–û–í–ê–ù ===")
    print("‚úÖ Backpack —Ç–µ–ø–µ—Ä—å –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º –≤–æ –≤—Ä–µ–º—è —Ç–æ—Ä–≥–æ–≤–ª–∏!")
    print("‚úÖ –§—É–Ω–∫—Ü–∏–∏ hide_ui –∏ set_visible –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω—ã")
    print("‚úÖ –†—é–∫–∑–∞–∫ –Ω–µ –±—É–¥–µ—Ç —Å–∫—Ä—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—á–∞–ª–µ —Ç—Ä–µ–π–¥–∞")
end

-- –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ô –í–ê–†–ò–ê–ù–¢ (–µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç)
local function alternativeBackpackSolution()
    print("\n=== –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–û–ï –†–ï–®–ï–ù–ò–ï ===")
    
    local Fsys = _G.Fsys or require(game:GetService("ReplicatedStorage").Fsys)
    
    -- –ü—Ä–æ—Å—Ç–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä—é–∫–∑–∞–∫ –∫–∞–∂–¥—ã–µ 0.5 —Å–µ–∫—É–Ω–¥—ã
    pcall(function()
        local BackpackFilter = Fsys.load("BackpackFilter")
        if BackpackFilter and BackpackFilter.set_visible then
            while true do
                task.wait(0.5)
                pcall(function()
                    BackpackFilter:set_visible(true)
                end)
            end
        end
    end)
end

-- –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç
keepBackpackActiveDuringTrade()

-- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
return {
    enableBackpack = keepBackpackActiveDuringTrade,
    alternativeMethod = alternativeBackpackSolution,
    
    -- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
    restoreOriginal = function()
        print("üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è...")
        -- –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É —á—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
        warn("–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–≥—Ä—É –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è")
    end
}
