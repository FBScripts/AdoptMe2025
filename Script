-- ==========================================
-- –ü–û–õ–ù–´–ô –î–ï–ë–ê–ì –ö–û–î –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê BACKPACK –ò –¢–†–ï–ô–î–ê
-- ==========================================

local function debugBackpackAndTradeSystem()
    print("=== –ù–ê–ß–ê–õ–û –ê–ù–ê–õ–ò–ó–ê BACKPACK –ò –¢–†–ï–ô–î –°–ò–°–¢–ï–ú–´ ===")
    
    -- –ó–∞–≥—Ä—É–∂–∞–µ–º Fsys –µ—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
    if not _G.Fsys then
        _G.Fsys = require(game:GetService("ReplicatedStorage").Fsys)
    end
    
    local Fsys = _G.Fsys
    
    -- 1. –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
    print("\n--- 1. –ê–ù–ê–õ–ò–ó –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô –ú–û–î–£–õ–ï–ô ---")
    local dependency_tree = Fsys.get_raw_dependency_tree()
    for module_name, dependencies in pairs(dependency_tree) do
        if string.find(module_name:lower(), "backpack") or 
           string.find(module_name:lower(), "trade") or 
           string.find(module_name:lower(), "inventory") or
           string.find(module_name:lower(), "pet") or
           string.find(module_name:lower(), "player") then
            print("–ú–æ–¥—É–ª—å:", module_name)
            for dep_name, _ in pairs(dependencies) do
                print("  –ó–∞–≤–∏—Å–∏—Ç –æ—Ç:", dep_name)
            end
        end
    end
    
    -- 2. –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å backpack –∏ trade
    print("\n--- 2. –ü–û–ò–°–ö –ú–û–î–£–õ–ï–ô –° BACKPACK –ò TRADE ---")
    local relevant_modules = {}
    
    -- –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥—É–ª–∏ —á–µ—Ä–µ–∑ Fsys
    for module_name, module_script in pairs(getfenv(Fsys.load).tbl_5_upvr or {}) do
        if string.find(tostring(module_name):lower(), "backpack") or 
           string.find(tostring(module_name):lower(), "trade") or 
           string.find(tostring(module_name):lower(), "inventory") or
           string.find(tostring(module_name):lower(), "pet") or
           string.find(tostring(module_name):lower(), "player") then
            table.insert(relevant_modules, module_name)
            print("–ù–∞–π–¥–µ–Ω —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –º–æ–¥—É–ª—å:", module_name)
        end
    end
    
    -- 3. –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –º–æ–¥—É–ª–µ–π
    print("\n--- 3. –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó –ö–õ–Æ–ß–ï–í–´–• –ú–û–î–£–õ–ï–ô ---")
    local key_modules = {
        "RouterClient",
        "TradeApi", 
        "PlayerApp",
        "FocusPetApp",
        "Backpack",
        "Inventory",
        "Trade",
        "PetApp"
    }
    
    for _, module_name in ipairs(key_modules) do
        pcall(function()
            local module = Fsys.load(module_name)
            if module then
                print("\n‚úÖ –ú–æ–¥—É–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω:", module_name)
                -- –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–æ–¥—É–ª—è
                for key, value in pairs(module) do
                    local key_str = tostring(key)
                    if string.find(key_str:lower(), "backpack") or 
                       string.find(key_str:lower(), "trade") or 
                       string.find(key_str:lower(), "inventory") or
                       string.find(key_str:lower(), "visible") or
                       string.find(key_str:lower(), "enable") or
                       string.find(key_str:lower(), "disable") then
                        print("  üîç –ù–∞–π–¥–µ–Ω –∫–ª—é—á:", key, "—Ç–∏–ø:", type(value))
                    end
                end
            end
        end)
        
        -- –ü—Ä–æ–±—É–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏
        pcall(function()
            local module = Fsys.load("package:" .. module_name)
            if module then
                print("\n‚úÖ –ü–∞–∫–µ—Ç–Ω—ã–π –º–æ–¥—É–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω: package:" .. module_name)
            end
        end)
    end
    
    -- 4. –ü–æ–∏—Å–∫ —Ñ—É–Ω–∫—Ü–∏–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç—å—é UI
    print("\n--- 4. –ü–û–ò–°–ö –§–£–ù–ö–¶–ò–ô –£–ü–†–ê–í–õ–ï–ù–ò–Ø UI ---")
    local function analyzeModuleForUIFunctions(module_name, module_table)
        if not module_table then return end
        
        for key, value in pairs(module_table) do
            if type(value) == "function" then
                local key_str = tostring(key):lower()
                if string.find(key_str, "set") and 
                   (string.find(key_str, "visible") or 
                    string.find(key_str, "enable") or
                    string.find(key_str, "show") or
                    string.find(key_str, "hide")) then
                    print("  üéØ –§—É–Ω–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç—å—é:", module_name .. "." .. key)
                    
                    -- –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ—É–Ω–∫—Ü–∏–∏
                    local success, func_info = pcall(debug.getinfo, value)
                    if success and func_info then
                        if func_info.source then
                            print("    üìç –ò—Å—Ç–æ—á–Ω–∏–∫:", func_info.source)
                        end
                        if func_info.linedefined then
                            print("    üìè –õ–∏–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:", func_info.linedefined)
                        end
                    end
                end
            end
        end
    end
    
    -- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª—é—á–µ–≤—ã–µ –º–æ–¥—É–ª–∏ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏ UI
    for _, module_name in ipairs(key_modules) do
        pcall(function()
            local module = Fsys.load(module_name)
            if module then
                analyzeModuleForUIFunctions(module_name, module)
            end
        end)
    end
    
    -- 5. –ü–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏–π —Ç–æ—Ä–≥–æ–≤–ª–∏
    print("\n--- 5. –ü–û–ò–°–ö –°–û–ë–´–¢–ò–ô –¢–û–†–ì–û–í–õ–ò ---")
    pcall(function()
        local TradeApi = Fsys.load("TradeApi")
        if TradeApi then
            print("üîç –ê–Ω–∞–ª–∏–∑ TradeApi –Ω–∞ —Å–æ–±—ã—Ç–∏—è:")
            for key, value in pairs(TradeApi) do
                local key_str = tostring(key):lower()
                if string.find(key_str, "event") or 
                   string.find(key_str, "start") or 
                   string.find(key_str, "end") or
                   string.find(key_str, "changed") then
                    print("  üì¢ –°–æ–±—ã—Ç–∏–µ/—Å–æ—Å—Ç–æ—è–Ω–∏–µ:", key, "—Ç–∏–ø:", type(value))
                end
            end
        end
    end)
    
    -- 6. –ê–Ω–∞–ª–∏–∑ RouterClient –¥–ª—è —Ç—Ä–µ–π–¥–∞
    print("\n--- 6. –ê–ù–ê–õ–ò–ó ROUTERCLIENT ---")
    pcall(function()
        local RouterClient = Fsys.load("RouterClient")
        if RouterClient then
            print("üîç –ê–Ω–∞–ª–∏–∑ RouterClient:")
            for key, value in pairs(RouterClient) do
                local key_str = tostring(key):lower()
                if string.find(key_str, "trade") or string.find(key_str, "route") then
                    print("  üõ£Ô∏è  –†–æ—É—Ç–µ—Ä/–¢—Ä–µ–π–¥:", key, "—Ç–∏–ø:", type(value))
                end
            end
        end
    end)
    
    -- 7. –ê–Ω–∞–ª–∏–∑ –∑–≤—É–∫–æ–≤ —Ç–æ—Ä–≥–æ–≤–ª–∏
    print("\n--- 7. –ê–ù–ê–õ–ò–ó –ó–í–£–ö–û–í –¢–û–†–ì–û–í–õ–ò ---")
    pcall(function()
        local Sounds = Fsys.load("Sounds")
        if Sounds then
            print("üîä –î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–≤—É–∫–∏:")
            for sound_name, sound_data in pairs(Sounds) do
                if string.find(sound_name:lower(), "trade") or 
                   string.find(sound_name:lower(), "purchase") or
                   string.find(sound_name:lower(), "select") then
                    print("  üîä –ó–≤—É–∫:", sound_name)
                    print("    üÜî ID:", sound_data.SoundId)
                    if sound_data.DefaultPlaybackProperties then
                        print("    üîä –ì—Ä–æ–º–∫–æ—Å—Ç—å:", sound_data.DefaultPlaybackProperties.Volume)
                    end
                end
            end
        end
    end)
    
    -- 8. –ü–æ–∏—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—É—Ç–µ–π –∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    print("\n--- 8. –ü–û–ò–°–ö –ü–£–¢–ï–ô –ö BACKPACK ---")
    
    -- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –∏–≥—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–∞—Ö
    local function findBackpackInGame()
        local players = game:GetService("Players")
        local localPlayer = players.LocalPlayer
        if localPlayer then
            -- –ò—â–µ–º –≤ PlayerGui
            local playerGui = localPlayer:FindFirstChild("PlayerGui")
            if playerGui then
                local function searchForBackpack(parent, depth)
                    if depth > 5 then return end -- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≥–ª—É–±–∏–Ω—É –ø–æ–∏—Å–∫–∞
                    
                    for _, child in ipairs(parent:GetChildren()) do
                        local name_lower = child.Name:lower()
                        if string.find(name_lower, "backpack") or 
                           string.find(name_lower, "inventory") or
                           string.find(name_lower, "focuspet") then
                            print("üéí –ù–∞–π–¥–µ–Ω –æ–±—ä–µ–∫—Ç:", child:GetFullName())
                            
                            -- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏
                            if child:IsA("GuiObject") then
                                print("   üëÅÔ∏è  Visible:", child.Visible)
                                print("   üîµ BackgroundTransparency:", child.BackgroundTransparency)
                            end
                        end
                        searchForBackpack(child, depth + 1)
                    end
                end
                
                searchForBackpack(playerGui, 0)
            end
        end
    end
    
    pcall(findBackpackInGame)
    
    -- 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π
    print("\n--- 9. –í–†–ï–ú–Ø –ó–ê–ì–†–£–ó–ö–ò –ú–û–î–£–õ–ï–ô ---")
    local timings = Fsys.get_raw_async_timings()
    for timing_name, timing_value in pairs(timings or {}) do
        if string.find(timing_name:lower(), "backpack") or 
           string.find(timing_name:lower(), "trade") or 
           string.find(timing_name:lower(), "pet") then
            print("‚è±Ô∏è  –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏:", timing_name, "=", timing_value)
        end
    end
    
    print("\n=== –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù ===")
    print("üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:")
    print("1. –ù–∞–π–¥–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç—å—é")
    print("2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–±—ã—Ç–∏—è –Ω–∞—á–∞–ª–∞/–æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏") 
    print("3. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∫–∞–∫ TradeApi –≤–ª–∏—è–µ—Ç –Ω–∞ UI —ç–ª–µ–º–µ–Ω—Ç—ã")
    print("4. –ù–∞–π–¥–∏—Ç–µ –≥–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ä—é–∫–∑–∞–∫–∞ –ø—Ä–∏ —Ç—Ä–µ–π–¥–µ")
end

-- –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑
debugBackpackAndTradeSystem()

-- –¢–∞–∫–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–æ—á–µ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
local function quickFindBackpack()
    print("\n=== –ë–´–°–¢–†–´–ô –ü–û–ò–°–ö BACKPACK ===")
    local Fsys = _G.Fsys or require(game:GetService("ReplicatedStorage").Fsys)
    
    pcall(function()
        local FocusPetApp = Fsys.load("FocusPetApp")
        if FocusPetApp then
            print("‚úÖ FocusPetApp –∑–∞–≥—Ä—É–∂–µ–Ω")
            for key, value in pairs(FocusPetApp) do
                if tostring(key):find("backpack") then
                    print("üéØ –ù–∞–π–¥–µ–Ω backpack –≤ FocusPetApp:", key)
                end
            end
        end
    end)
end

-- –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
return {
    debugBackpackAndTradeSystem = debugBackpackAndTradeSystem,
    quickFindBackpack = quickFindBackpack
}
